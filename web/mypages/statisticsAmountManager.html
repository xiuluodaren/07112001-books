<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>

    <meta charset="utf-8">

    <title>租金统计</title>
    <!--引入相关的js文件-->
    <link href="../backPage/ui/bootstrap-3.3.0/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="../backPage/ui/bootstrap-table-1.11.0/bootstrap-table.min.css" rel="stylesheet"/>
    <link href="../backPage/ui/waves-0.7.5/waves.css" rel="stylesheet"/>
    <link href="../backPage/ui/jquery-confirm/jquery-confirm.min.css" rel="stylesheet"/>
    <link href="../bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet"/>

    <script src="../backPage/ui/js/jquery-3.3.1.min.js"></script>
    <script src="../backPage/ui/waves-0.7.5/waves.js"></script>
    <script src="../backPage/ui/jquery-confirm/jquery-confirm.min.js"></script>
    <script src="../backPage/ui/bootstrap-3.3.0/js/bootstrap.min.js"></script>
    <script src="../backPage/ui/bootstrap-table-1.11.0/bootstrap-table.min.js"></script>
</head>

<body>
<div id="main">
    <div id="toolbar">
        <label for="startTime">开始时间</label>
        <input id="startTime" class="btn btn-default" style="height: 34px;padding: 0;" type="date" />
        <label for="endTime">结束时间</label>
        <input id="endTime"class="btn btn-default" style="height: 34px;padding: 0;" type="date" />
        <button class="btn btn-default" href="javascript:;" onclick="searchAction()">查询</button>
        <br/>
    </div>
    <table id="table"></table>
</div>

<script>

    Date.prototype.format = function(fmt) {
        var o = {
            "M+" : this.getMonth()+1,                 //月份
            "d+" : this.getDate(),                    //日
            "h+" : this.getHours(),                   //小时
            "m+" : this.getMinutes(),                 //分
            "s+" : this.getSeconds(),                 //秒
            "q+" : Math.floor((this.getMonth()+3)/3), //季度
            "S"  : this.getMilliseconds()             //毫秒
        };
        if(/(y+)/.test(fmt)) {
            fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));
        }
        for(var k in o) {
            if(new RegExp("("+ k +")").test(fmt)){
                fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));
            }
        }
        return fmt;
    }

    // 初始化input特效
    function initMaterialInput() {
        $('form input[type="text"]').each(function () {
            if ($(this).val() != '') {
                $(this).parent().find('label').addClass('active');
            }
        });
    }

    initMaterialInput();

    $("#startTime").val(new Date().format("yyyy-MM-dd"));
    $("#endTime").val(new Date().format("yyyy-MM-dd"));

    var $table = $('#table');

    $(function() {

        // bootstrap table初始化
        $table.bootstrapTable({
            url: '/lease?method=find&isPayment=1',
            height: getHeight(),
            clickToSelect: true,
            toolbar:'#toolbar',
            striped: true,
            showRefresh: true,
            minimumCountColumns: 2,
            paginationLoop: false,
            sidePagination: 'server',
            silentSort: false,
            sortOrder: "desc",
            smartDisplay: false,
            escape: true,
            idField: 'id',
            maintainSelected: true,
            columns: [
                {field: 'id', title: '编号', align: 'center'},
                {field: 'carName', title: '车辆名称',align: 'center'},
                {field: 'state', title: '车辆状态',align: 'center',
                    formatter:function(value, row, index){
                        if (value == 0)
                        {
                            return "已还车";
                        }else if (value == 1){
                            return "未还车";
                        }
                    }},
                {field: 'driverName', title: '司机名称',align: 'center'},
                {field: 'customerName', title: '客户名称',align: 'center'},
                {field: 'startTime', title: '开始时间',align: 'center',formatter:timeFormatter},
                {field: 'endTime', title: '结束时间',align: 'center',formatter:timeFormatter},
                {field: 'amount', title: '租金',align: 'center'},
                {field: 'isPayment', title: '是否支付',align: 'center',
                    formatter:function(value, row, index){
                        if (value == 0)
                        {
                            return "未支付";
                        }else if (value == 1){
                            return "已支付";
                        }
                    }}
            ],
            onLoadError:function (status, res){
                console.info(status);
                console.info(res);
                var url = window.location.protocol + "//" + window.location.host + "/";
                parent.window.location.href = url;
            },
            onLoadSuccess:function (data){
                console.info(data);
                var sumRow = {
                    carName : "合计",
                    amount : data.sumAmount
                };
                $table.bootstrapTable("append",sumRow);
            },
        });
    });

    // 格式化操作按钮
    function actionFormatter(value, row, index) {
        return [
            '<a class="update" href="javascript:;" onclick="updateAction()" data-toggle="tooltip" title="编辑"><i class="glyphicon glyphicon-edit"></i></a>　',
            '<a class="delete" href="javascript:;" onclick="deleteAction()" data-toggle="tooltip" title="删除"><i class="glyphicon glyphicon-remove"></i></a>'
        ].join('');
    }
    // 格式化时间
    function timeFormatter(value , row, index) {
        if (value == null) return value;
        return new Date(value).toLocaleString().split(' ')[0];
    }

    function getHeight() {
        return $(window).height() - 20;
    }

    function searchAction ()
    {
        var startTime = $("#startTime").val();
        var endTime = $("#endTime").val();

        var url = "/lease?method=find&isPayment=1&startTime=" + startTime + "&endTime=" + endTime;
        $table.bootstrapTable('refresh',{url:url});

    }

</script>

</body>
</html>
